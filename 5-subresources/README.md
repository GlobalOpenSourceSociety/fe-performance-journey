# 页面静态资源

[🔙 上一站 - 页面解析与处理](../4-parse/README.md)

在上一节中，我们介绍了基本的页面解析机制，通过对资源加载顺序和脚本加载的控制，避免了无谓的阻塞，优化了解析性能。

也正如上一节所说，这时浏览器除了解析页面 DOM 外，还会对子（静态）资源发起请求，请求回来后会执行或使用资源。这一节咱们就来具体看看这个阶段。

## 1. 总体原则

这一部分会涉及到各类常见的静态资源：JavaScript 脚本、CSS 样式表、图片、字体、视频等。不同资源的具体优化措施在实施上面会有较大差别，所以我会以各类资源为维度，针对性介绍优化的关注点和手段。

但是，其实在总体原则上，各类资源的优化思路都是大体类似的，包括：

- 减少不必要的请求
- 减少包体大小
- 降低资源执行/使用时的消耗
- 利用缓存

为了大家能更好理解各类优化实施策略是从何而来，先简单扩展一下以上的思路。

### 1.1. 减少不必要的请求

核心其实是希望能够减少请求的数量，因为浏览器对同源请求有并发上限限制（例如 Chrome 是6），而在 HTTP/1.1 下并不具备 Push 能力，所以请求过多可能会导致请求被排队了。一个典型场景就是页面加载后需要请求十几张图片。

同时，TCP/IP 传输也有慢启动的特点，连接刚建立时包体传输速率较低，后续会渐渐提速。因此，过多的“小”请求也不是一个利用率很高的表现。

减少不必要的请求主要分为几个维度：

- 对于不需要使用的内容，其实不需要请求，相当于做了无用功；
- 对于可以延迟加载的内容，不必要现在就立刻加载，最好的时间就是在需要使用之前加载；
- 有时合并资源也是一种方法。

### 1.2. 减少包体大小

包体大小对性能也是有直接影响的。同样速率下，包体越小，传输耗时越低，整体页面加载与渲染的性能也会更好。

减少包体大小常用的方式包括了：

- 使用适合当前资源的压缩算法；
- 响应包体里避免“塞入”一些不需要的内容。

### 1.3. 降低资源执行/使用时的消耗

大家主要的关注点都在页面资源加载的效率，其实有些时候，对于资源的执行或使用也是有消耗的。例如加载并执行了一段 CPU 密集的 JavaScript 脚本，或者在加载完成后重度地开始操作 DOM，这些都会让 JavaScript 的执行变成影响性能的一大问题。虽然今天的 JavaScript 引擎已经很快了，但是一些不当的操作仍然会带来性能的损耗。

此外，像是 CSS 选择器匹配、图片的解析与处理等，都是要消耗 CPU 和内存的。也许这些不太常成为性能杀手，但是了解它们也可能会对你有所帮助。

### 1.4. 利用缓存

还记得咱们这趟旅程从哪出发的么？没错，缓存。

在第一节中，我们介绍了浏览器访问一个页面 URL 时的多级缓存策略。千万不要忘了，这些静态子资源也是网络请求，它们仍然可以利用之前介绍的完整缓存流程。缓存在很多时候会是一个非常有效的手段，来帮助你解决资源加载的性能问题。

由于第一节已经针对缓存进行了详细介绍，这一部分只会简单提及一些。它们的思想很多都是相通的。

## 2. 了解各类资源

以上的原则可以指导我们针对性地优化各类资源。下面会以资源类型为维度，详细介绍其中涉及到的优化点与优化措施。如果你一口气读到这里，可能有些累了。不如先放松一下，伸个懒腰。根据以上的原则，整理回忆一下你常用的有些优化手段。

如果准备好了，咱们可以继续出发了：

- [JavaScript](./javascript.md)
- [CSS](./css.md)
- [图片](./image.md)
- [字体](./font.md)
- [音视频](./video.md)

---
